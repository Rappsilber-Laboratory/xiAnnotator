package org.rappsilber;

import javax.ws.rs.client.Client;
import javax.ws.rs.client.ClientBuilder;
import javax.ws.rs.client.Entity;
import javax.ws.rs.client.WebTarget;
import javax.ws.rs.core.MediaType;

import org.glassfish.grizzly.http.server.HttpServer;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class xiAnnotatorTestPost {

    private HttpServer server;
    private WebTarget target;

    @Before
    public void setUp() throws Exception {
        // start the server
        server = Main.startServer();
        // create the client
        Client c = ClientBuilder.newClient();

        // uncomment the following line if you want to enable
        // support for JSON in the client (you also have to uncomment
        // dependency on jersey-media-json module in pom.xml and Main.startServer())
        // --
        // c.configuration().enable(new org.glassfish.jersey.media.json.JsonJaxbFeature());

        target = c.target(Main.BASE_URI);
    }

    @After
    public void tearDown() throws Exception {
        server.stop();
    }

    /**
     * Test to see that the message "Got it!" is sent in the response.
     */
    @Test
    public void testGetIt() {
        StringBuffer json = new StringBuffer("{\"Peptides\":[{\"sequence\":[{\"aminoAcid\":\"N\",\"Modification\":\"\"},{\"aminoAcid\":\"G\",\"Modification\":\"\"},{\"aminoAcid\":\"H\",\"Modification\":\"\"},{\"aminoAcid\":\"L\",\"Modification\":\"\"},{\"aminoAcid\":\"F\",\"Modification\":\"\"},{\"aminoAcid\":\"V\",\"Modification\":\"\"},{\"aminoAcid\":\"T\",\"Modification\":\"\"},{\"aminoAcid\":\"D\",\"Modification\":\"\"},{\"aminoAcid\":\"G\",\"Modification\":\"\"},{\"aminoAcid\":\"V\",\"Modification\":\"\"},{\"aminoAcid\":\"V\",\"Modification\":\"\"},{\"aminoAcid\":\"K\",\"Modification\":\"\"},{\"aminoAcid\":\"I\",\"Modification\":\"\"},{\"aminoAcid\":\"R\",\"Modification\":\"\"}]},{\"sequence\":[{\"aminoAcid\":\"Y\",\"Modification\":\"\"},{\"aminoAcid\":\"L\",\"Modification\":\"\"},{\"aminoAcid\":\"M\",\"Modification\":\"\"},{\"aminoAcid\":\"G\",\"Modification\":\"\"},{\"aminoAcid\":\"V\",\"Modification\":\"\"},{\"aminoAcid\":\"G\",\"Modification\":\"\"},{\"aminoAcid\":\"K\",\"Modification\":\"\"},{\"aminoAcid\":\"P\",\"Modification\":\"\"},{\"aminoAcid\":\"E\",\"Modification\":\"\"},{\"aminoAcid\":\"D\",\"Modification\":\"\"},{\"aminoAcid\":\"L\",\"Modification\":\"\"},{\"aminoAcid\":\"V\",\"Modification\":\"\"},{\"aminoAcid\":\"E\",\"Modification\":\"\"},{\"aminoAcid\":\"G\",\"Modification\":\"\"},{\"aminoAcid\":\"V\",\"Modification\":\"\"},{\"aminoAcid\":\"R\",\"Modification\":\"\"}]}],\"LinkSite\":[{\"id\":0,\"peptideId\":0,\"linkSite\":11},{\"id\":0,\"peptideId\":1,\"linkSite\":6}],\"peaks\":[{\"mz\":104.0532364194653,\"intensity\":14701.277864637568},{\"mz\":110.0716629,\"intensity\":55653.97265625},{\"mz\":120.0810623,\"intensity\":34164.56640625},{\"mz\":129.1024323,\"intensity\":32862.765625},{\"mz\":136.0758362,\"intensity\":161772.5},{\"mz\":137.0792084,\"intensity\":14446.189453125},{\"mz\":138.0914764,\"intensity\":159151.09375},{\"mz\":143.1180725,\"intensity\":22586.955078125},{\"mz\":157.0973053,\"intensity\":13775.57421875},{\"mz\":158.0925446,\"intensity\":13238.287109375},{\"mz\":159.0919342,\"intensity\":13306.033203125},{\"mz\":171.1129456,\"intensity\":12514.78515625},{\"mz\":173.1286621,\"intensity\":12448.0810546875},{\"mz\":175.1191559,\"intensity\":114822.875},{\"mz\":185.1650696,\"intensity\":12698.7666015625},{\"mz\":187.090271,\"intensity\":13720.46875},{\"mz\":189.0693359,\"intensity\":13203.1533203125},{\"mz\":189.087265,\"intensity\":12517.376953125},{\"mz\":199.1079407,\"intensity\":25332.900390625},{\"mz\":201.1236115,\"intensity\":26673.03515625},{\"mz\":217.0821381,\"intensity\":33240.55859375},{\"mz\":227.1027985,\"intensity\":41800.16015625},{\"mz\":229.1184692,\"intensity\":12198.5927734375},{\"mz\":240.1344147,\"intensity\":30673.60546875},{\"mz\":249.1598816,\"intensity\":156042.359375},{\"mz\":250.1633453,\"intensity\":21684.220703125},{\"mz\":251.1504517,\"intensity\":20624.76171875},{\"mz\":271.1476135,\"intensity\":18529.01953125},{\"mz\":274.1034241,\"intensity\":20450.611328125},{\"mz\":274.187561,\"intensity\":13761.5634765625},{\"mz\":277.1548157,\"intensity\":129603.5},{\"mz\":278.1581421,\"intensity\":16480.30859375},{\"mz\":280.1636353,\"intensity\":27715.4921875},{\"mz\":285.1920776,\"intensity\":17828.41015625},{\"mz\":288.1377563,\"intensity\":14147.671875},{\"mz\":288.203125,\"intensity\":54169.96875},{\"mz\":291.1201477,\"intensity\":26422.216796875},{\"mz\":309.1306458,\"intensity\":115898.2578125},{\"mz\":310.134552,\"intensity\":14576.1259765625},{\"mz\":320.6820679,\"intensity\":40234.46875},{\"mz\":327.1662598,\"intensity\":12967.060546875},{\"mz\":331.2091675,\"intensity\":103517.921875},{\"mz\":334.6795349,\"intensity\":14676.791015625},{\"mz\":342.1297913,\"intensity\":63554.3671875},{\"mz\":362.1856384,\"intensity\":8830.9140625},{\"mz\":371.2058105,\"intensity\":10054.923828125},{\"mz\":376.1976929,\"intensity\":10932.5732421875},{\"mz\":385.2033997,\"intensity\":39408.70703125},{\"mz\":385.7049561,\"intensity\":12542.7109375},{\"mz\":394.2200012,\"intensity\":19737.9375},{\"mz\":396.2242126,\"intensity\":14462.162109375},{\"mz\":402.2097473,\"intensity\":11828.009765625},{\"mz\":408.1955261,\"intensity\":15001.3798828125},{\"mz\":422.2149353,\"intensity\":82557.0703125},{\"mz\":423.2192078,\"intensity\":13708.615234375},{\"mz\":433.2449341,\"intensity\":15447.12109375},{\"mz\":433.7115479,\"intensity\":11538.9365234375},{\"mz\":442.7172241,\"intensity\":24827.541015625},{\"mz\":455.2139587,\"intensity\":18415.517578125},{\"mz\":460.251709,\"intensity\":190829.1875},{\"mz\":461.2554626,\"intensity\":37782.8515625},{\"mz\":465.2169495,\"intensity\":23122.91015625},{\"mz\":470.3091431,\"intensity\":47339.609375},{\"mz\":471.2279968,\"intensity\":31732.498046875},{\"mz\":497.7593689,\"intensity\":15923.3779296875},{\"mz\":498.2612,\"intensity\":22072.59765625},{\"mz\":502.2815247,\"intensity\":19782.904296875},{\"mz\":506.7648621,\"intensity\":15156.7158203125},{\"mz\":507.2671814,\"intensity\":225948.265625},{\"mz\":507.7687683,\"intensity\":94754.3203125},{\"mz\":508.2704163,\"intensity\":22450.166015625},{\"mz\":520.762085,\"intensity\":16243.251953125},{\"mz\":527.2650146,\"intensity\":17011.98046875},{\"mz\":536.2907715,\"intensity\":29314.337890625},{\"mz\":541.2893677,\"intensity\":17231.333984375},{\"mz\":559.3205566,\"intensity\":117569.7421875},{\"mz\":560.3239136,\"intensity\":32399.599609375},{\"mz\":564.2858276,\"intensity\":51468.59375},{\"mz\":565.2883301,\"intensity\":15041.27734375},{\"mz\":569.2838135,\"intensity\":112498.53125},{\"mz\":569.3775635,\"intensity\":104912.46875},{\"mz\":570.2866211,\"intensity\":28079.205078125},{\"mz\":570.3809204,\"intensity\":31975.056640625},{\"mz\":572.7717896,\"intensity\":9713.3876953125},{\"mz\":601.3485718,\"intensity\":35484.859375},{\"mz\":602.352356,\"intensity\":11517.05859375},{\"mz\":605.9821777,\"intensity\":12094.9033203125},{\"mz\":619.3604736,\"intensity\":44672.3359375},{\"mz\":620.3630981,\"intensity\":10548.6171875},{\"mz\":621.305603,\"intensity\":8016.7768554688},{\"mz\":629.3134155,\"intensity\":9542.09765625},{\"mz\":629.8143311,\"intensity\":8620.94921875},{\"mz\":638.3337402,\"intensity\":23259.34375},{\"mz\":640.3577881,\"intensity\":14876.4267578125},{\"mz\":651.3250122,\"intensity\":7273.7275390625},{\"mz\":668.3522339,\"intensity\":116847.6484375},{\"mz\":668.4451294,\"intensity\":12708.251953125},{\"mz\":669.3556519,\"intensity\":35249.09375},{\"mz\":672.4042969,\"intensity\":43438.30078125},{\"mz\":673.4078979,\"intensity\":12186.103515625},{\"mz\":678.8484497,\"intensity\":8465.84765625},{\"mz\":683.3255615,\"intensity\":6596.6987304688},{\"mz\":696.3696899,\"intensity\":30282.791015625},{\"mz\":696.6867065,\"intensity\":18690.234375},{\"mz\":702.6208496,\"intensity\":7259.4267578125},{\"mz\":725.4679565,\"intensity\":41355.67578125},{\"mz\":757.4396362,\"intensity\":37477.51953125},{\"mz\":769.3986816,\"intensity\":18806.193359375},{\"mz\":770.397583,\"intensity\":25372.935546875},{\"mz\":775.4505615,\"intensity\":26008.650390625},{\"mz\":787.432251,\"intensity\":60518.29296875},{\"mz\":788.4349976,\"intensity\":24464.990234375},{\"mz\":803.4133301,\"intensity\":71059.609375},{\"mz\":804.4160767,\"intensity\":27800.533203125},{\"mz\":804.947876,\"intensity\":62451.4375},{\"mz\":805.4508057,\"intensity\":46940.6171875},{\"mz\":805.9505615,\"intensity\":20234.080078125},{\"mz\":811.928772,\"intensity\":36239.1796875},{\"mz\":812.430603,\"intensity\":66647.4921875},{\"mz\":812.927124,\"intensity\":22156.091796875},{\"mz\":820.9335327,\"intensity\":251607.265625},{\"mz\":821.4350586,\"intensity\":219102.25},{\"mz\":821.9362793,\"intensity\":102890.46875},{\"mz\":822.4371948,\"intensity\":34447.859375},{\"mz\":835.3850708,\"intensity\":35938.35546875},{\"mz\":840.4954224,\"intensity\":36543.95703125},{\"mz\":864.4653931,\"intensity\":17001.615234375},{\"mz\":872.4667969,\"intensity\":21696.541015625},{\"mz\":884.4277344,\"intensity\":18668.15234375},{\"mz\":890.4777222,\"intensity\":36766.4453125},{\"mz\":891.4810791,\"intensity\":15085.513671875},{\"mz\":902.8081665,\"intensity\":19658.072265625},{\"mz\":908.4706421,\"intensity\":42648.04296875},{\"mz\":908.9718018,\"intensity\":45222.46875},{\"mz\":909.4737549,\"intensity\":23587.515625},{\"mz\":916.4771729,\"intensity\":20093.28515625},{\"mz\":917.4785156,\"intensity\":10941.88671875},{\"mz\":924.4572754,\"intensity\":64558.69140625},{\"mz\":924.9578857,\"intensity\":62674.21484375},{\"mz\":925.4605103,\"intensity\":33914.64453125},{\"mz\":925.9603271,\"intensity\":13670.287109375},{\"mz\":935.4906006,\"intensity\":13792.1005859375},{\"mz\":941.4489136,\"intensity\":52597.171875},{\"mz\":941.5401001,\"intensity\":23843.015625},{\"mz\":942.4521484,\"intensity\":24487.806640625},{\"mz\":942.5432739,\"intensity\":11611.509765625},{\"mz\":973.513916,\"intensity\":41320.2890625},{\"mz\":974.5180054,\"intensity\":16139.61328125},{\"mz\":991.5253906,\"intensity\":25686.48046875},{\"mz\":992.5297852,\"intensity\":8494.671875},{\"mz\":995.5175171,\"intensity\":12642.2314453125},{\"mz\":1013.527344,\"intensity\":286512.9375},{\"mz\":1014.530396,\"intensity\":146679.25},{\"mz\":1015.532471,\"intensity\":44977.80859375},{\"mz\":1016.535645,\"intensity\":8371.0048828125},{\"mz\":1017.531189,\"intensity\":2843.1369628906},{\"mz\":1022.505249,\"intensity\":4554.2470703125},{\"mz\":1029.509399,\"intensity\":3328.4365234375},{\"mz\":1040.51709,\"intensity\":19931.34375},{\"mz\":1040.609985,\"intensity\":6192.2016601563},{\"mz\":1041.522583,\"intensity\":9418.390625},{\"mz\":1041.613037,\"intensity\":3447.0053710938},{\"mz\":1042.52356,\"intensity\":2687.7958984375},{\"mz\":1054.571411,\"intensity\":2828.4013671875},{\"mz\":1072.583984,\"intensity\":17708.3515625},{\"mz\":1073.585693,\"intensity\":11345.7880859375},{\"mz\":1074.584839,\"intensity\":3904.2331542969},{\"mz\":1090.591919,\"intensity\":4082.1877441406},{\"mz\":1139.586426,\"intensity\":6708.8564453125},{\"mz\":1144.536621,\"intensity\":18095.744140625},{\"mz\":1145.540894,\"intensity\":9396.115234375},{\"mz\":1145.606323,\"intensity\":1723.8804931641},{\"mz\":1146.538696,\"intensity\":3934.8103027344},{\"mz\":1169.518921,\"intensity\":2271.3142089844},{\"mz\":1177.505981,\"intensity\":2416.4401855469},{\"mz\":1187.679443,\"intensity\":7452.990234375},{\"mz\":1188.682983,\"intensity\":5987.0434570313},{\"mz\":1195.634277,\"intensity\":5853.7631835938},{\"mz\":1196.634766,\"intensity\":2566.0532226563},{\"mz\":1201.642578,\"intensity\":5721.4169921875},{\"mz\":1202.643677,\"intensity\":3587.4934082031},{\"mz\":1219.652344,\"intensity\":29251.892578125},{\"mz\":1220.655518,\"intensity\":18797.205078125},{\"mz\":1221.660034,\"intensity\":6352.37109375},{\"mz\":1227.603271,\"intensity\":2967.1525878906},{\"mz\":1237.660767,\"intensity\":4149.416015625},{\"mz\":1252.654053,\"intensity\":24657.275390625},{\"mz\":1253.656616,\"intensity\":15987.7548828125},{\"mz\":1254.661011,\"intensity\":4177.6245117188},{\"mz\":1257.619873,\"intensity\":10305.939453125},{\"mz\":1258.623535,\"intensity\":6867.6953125},{\"mz\":1259.616333,\"intensity\":2952.9895019531},{\"mz\":1284.627197,\"intensity\":18246.42578125},{\"mz\":1285.632202,\"intensity\":11803.7861328125},{\"mz\":1286.630127,\"intensity\":5069.86328125},{\"mz\":1289.593262,\"intensity\":3269.6201171875},{\"mz\":1290.592285,\"intensity\":2803.9128417969},{\"mz\":1300.761353,\"intensity\":3650.4965820313},{\"mz\":1302.635986,\"intensity\":4133.65234375},{\"mz\":1303.638306,\"intensity\":2850.7570800781},{\"mz\":1332.630981,\"intensity\":4031.1013183594},{\"mz\":1332.736816,\"intensity\":14966.240234375},{\"mz\":1333.644043,\"intensity\":2540.1252441406},{\"mz\":1333.738281,\"intensity\":9428.275390625},{\"mz\":1334.738892,\"intensity\":4180.0673828125},{\"mz\":1351.720947,\"intensity\":3590.7470703125},{\"mz\":1353.66333,\"intensity\":2357.3605957031},{\"mz\":1356.686035,\"intensity\":2533.0041503906},{\"mz\":1357.694458,\"intensity\":1759.7564697266},{\"mz\":1408.745728,\"intensity\":5516.7924804688},{\"mz\":1409.747803,\"intensity\":5737.048828125},{\"mz\":1440.716309,\"intensity\":3728.1325683594},{\"mz\":1441.717651,\"intensity\":1944.5769042969},{\"mz\":1442.727173,\"intensity\":1680.8146972656},{\"mz\":1539.782349,\"intensity\":3563.4350585938},{\"mz\":1540.786499,\"intensity\":3454.7963867188},{\"mz\":1572.758057,\"intensity\":1425.707519531}],\"annotation\":{\"fragmentTolerance\":{\"tolerance\":5,\"unit\":\"ppm\"},\"modifications\":[],\"ions\":[{\"type\":\"PeptideIon\"},{\"type\":\"BIon\"},{\"type\":\"YIon\"}],\"crosslinker\":{\"modMass\":158.0037648},\"precursorCharge\":5,\"losses\":[{\"specificity\":[\"S\",\"T\",\"D\",\"E\",\"CTerm\"],\"id\":\"H20\",\"mass\":18.01056027},{\"specificity\":[\"Q\",\"R\",\"K\",\"N\",\"NTerm\"],\"id\":\"NH3\",\"mass\":17.02654493},{\"specificity\":[\"Mox\"],\"id\":\"CH3SOH\",\"mass\":63.99828547}],\"custom\":[\"XICLASS:SimpleXiProcessMultipleCandidates\",\"FRAGMENTTREE:FU\",\"loss:CleavableCrossLinkerPeptide:MASS:54.0105647;NAME:A\",\"loss:CleavableCrossLinkerPeptide:MASS:103.9932001;NAME:S\",\"loss:CleavableCrossLinkerPeptide:MASS:85.9826354;NAME:T\",\"modification:variable::SYMBOLEXT:dssooh;MODIFIED:K;DELTAMASS:176.0143295\",\"modification:variable::SYMBOLEXT:dssonh;MODIFIED:K;DELTAMASS:175.030313905\",\"\",\"missing_isotope_peaks:2\"],\"precursorMZ\":695.5641564937337,\"requestID\":\"140866059151629278259175\"}}");
        String responseMsg = target.path("annotate/FULL")
                .request().post(Entity.entity(json.toString(), MediaType.APPLICATION_JSON),String.class);
        
        System.out.println(responseMsg);
        assertEquals("{\"error\":\"No Spectra\"}", responseMsg);
    }
}
